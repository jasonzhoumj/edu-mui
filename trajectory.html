<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>运动轨迹</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.css" rel="stylesheet" />
		<link href="css/mui.dtpicker.css" rel="stylesheet" />
		<link href="css/mui.picker.css" rel="stylesheet" />
		<link href="css/iconfont.css" rel="stylesheet" />
		<style type="text/css">
			.top-banner {
				position: relative;
				width: 100%;
				background-color: #fff;
				opacity: 0.9;
			}

			.left {
				margin: 0 20px;
				padding: 15px 0;
			}
			.calendar-container {
				float: right;
				font-size:23px;
			}
			.controll-container {
				position: relative;
				width: 100%;
				background-color: #fff;
				opacity: 0.9;
				border-top: 1px #C7C7CC solid;
			}
			.controll {
				margin: 0 20px;
				padding: 10px 0;
			}
			.controll-button-container {
				display: inline-block;
				vertical-align: middle;
			}
			.map {
				position: absolute;
				top: 105px;
				left: 0;
				bottom: 0;
				display: block;
				width: 100%;
			}
			.controll-button {
				margin: 0 5px;
			}
		</style>
	</head>

	<body>
		<div class="mui-content">
			<div class="top-banner">
				<div class="left">
					<span class="nowTime">2018年12月10日  星期三</span>
					<span class="mui-icon iconfont icon-rili calendar-container"></span>
				</div>
			</div>
			<div class="controll-container">
				<div class="controll">
					<span>回放控制</span>
					<span class="controll-button-container">
						<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined controll-button" onclick="startAnimation()">开始播放</button>
						<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined controll-button" onclick="stopAnimation()">结束播放</button>
						<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined controll-button" onclick="restartAnimation()">重新播放</button>
					</span>
				</div>
			</div>
			<div id="map" class="map"></div>
		</div>
		<script src="js/mui.js"></script>
		<script src="js/mui.dtpicker.js"></script>
		<script src="js/mui.picker.min.js"></script>
		<script src="js/jquery/jquery.min.js"></script>
		<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.4.6&key=a67f74a9f39540e85e75335a22123e45&plugin=Map3D,AMap.DistrictSearch,AMap.MarkerClusterer"></script>
		<script type="text/javascript">
			mui.init()
			
			function nowDate(myDate){
				if(myDate != '' || typeof(myDate) != 'undefined'){
					//var myDate = new Date();
					var year = myDate.getFullYear() + "";
					var month = myDate.getMonth() + 1 + "";
					var day = myDate.getDate() + ""; //获取当前日(1-31)
					if(month.length < 2) {
						month = "0" + month;
					}
					var week = myDate.getDay();//获取当前星期X(0-6,0代表星期天)
					var weekday=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];
					var weekStr = weekday[week]
					
					var nowTime = year + "年" + month  + "月" + day + "日   " + weekStr;
					$('.nowTime').text(nowTime);
				}
			}
			
			var map;
			 var marker, lineArr = [[116.478935,39.997761],[116.478939,39.997825],[116.478912,39.998549],
			 [116.478912,39.998549],[116.478998,39.998555],[116.478998,39.998555],[116.479282,39.99856],
			 [116.479658,39.998528],[116.480151,39.998453],[116.480784,39.998302],[116.480784,39.998302],
			 [116.481149,39.998184],[116.481573,39.997997],[116.481863,39.997846],[116.482072,39.997718],
			 [116.482362,39.997718],[116.483633,39.998935],[116.48367,39.998968],[116.484648,39.999861]];
			function loadMap() {
				var lon = 119.92,
					lat = 28.45; // 3311 丽水 
				var zoomMap = 14;
				//if (area.length==4) zoomMap=12; 
				//if (area.length==6) zoomMap=14;
				//if (area.length>6)  zoomMap=18;
				map = new AMap.Map('map', {
					resizeEnable: true,
					zoom: zoomMap,
					//layers: [new AMap.TileLayer.Satellite()],
					center: [lon, lat]
				});
				marker = new AMap.Marker({
					map: map,
					position: [116.478935,39.997761],
					icon: "https://webapi.amap.com/images/car.png",
					offset: new AMap.Pixel(-26, -13),
					autoRotation: true,
					angle:-90,
				});
				// 绘制轨迹
				var polyline = new AMap.Polyline({
					map: map,
					path: lineArr,
					showDir:true,
					strokeColor: "#28F",  //线颜色
					// strokeOpacity: 1,     //线透明度
					strokeWeight: 6,      //线宽
					// strokeStyle: "solid"  //线样式
				});
		
				var passedPolyline = new AMap.Polyline({
					map: map,
					// path: lineArr,
					strokeColor: "#AF5",  //线颜色
					// strokeOpacity: 1,     //线透明度
					strokeWeight: 6,      //线宽
					// strokeStyle: "solid"  //线样式
				});
				
				marker.on('moving', function (e) {
					passedPolyline.setPath(e.passedPath);
				});
				map.setFitView();
			}
			loadMap();
			nowDate(new Date());
			
			function startAnimation () {
				marker.moveAlong(lineArr, 200);
			}
			
			function stopAnimation () {
				marker.stopMove();
			}
			
			function restartAnimation () {
				marker.stopMove();
				marker.moveAlong(lineArr, 200);
			}
			$('.calendar-container').on('click', function(){
				var dtpicker = new mui.DtPicker({
					"type": "date",//设置日历初始视图模式
					//"beginDate": new Date(nowYear,nowMonth,nowDay)//设置开始日期
					"endDate": new Date(),//设置结束日期
					//"labels": ['Year','Mon','Day','hour', 'min'],//设置默认标签
					/* "customData": {
						"h": [ 
							{ value: "am", text: "上午" },
							{ value: "pm", text: "下午" },
						]//时间日期别名
					} */
				})
				dtpicker.show(function(e) { 
					nowDate(new Date(e.y.value,e.m.value - 1,e.d.value));
					//请求轨迹点
				})
			})
		</script>
	</body>
</html>
